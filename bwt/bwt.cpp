#include <core/pch.hpp>
#include <core/noncopyable.hpp>

#include <suffixarray/suffixarray.hpp>
#include <bwt/bwt.hpp>

USINGNAMESPACE(compression)

int main()
{
    struct sa_traits
    {
        static int abc_size()
        {
            return 255;
        }
    };

    //std::string str("mmiissiissiippii");
    std::string str("11001111110111010111011001000101100010111011010001011000010000010011101000100000111101010100000100001000011000011011000001000011000110101111001001111100110100111101101111001100100101100011011111000100010010010110110011011110100011001111011111100000101100100110011011000011100101101110110101101000101100111011010001010010010101000101010100001101100100010111001001111000010100000011011101100101010001001110110110101011101011000010111111010110000011110101000101101001010110111111101001001110101101100110000101111110001100110011010000000110011100010001100001000110010111111000010010001011111001001110001000000010000011111000101000110100001000100110011011110011001110100010011000011000001001111100110101010001100101100110111111101110101001010010100011100001101100010000001101000010100100010010011000001101011011110101010100110001011010110101000011011100000011010000111100000000111001110011111001110111000100001100100111001111001100011101010111000101010011001101100000000101110001100100101010111110110011000101100000101101100111001000011101100111111111010000001000000111110111111011100011011101001001011101010111101110100010111010101110010010011000100010101001101011111001010001000011010101110001000001010000010000111110001101111011001000011111011100010010001101110101101100010101110101011000111101010100111011000101110110001100001010000010110101110011111001001101011000110010010101110100011011101000110000011110011101110110111001011111111010001011111011101000001010000001011111011111100100010001100100101111000110110110001011001000100001000010010100001000010001111000001010000000011110110101110110111011111010101010111110111101000111111011101111011011000100010111100101001001101000011111010111100010000000011101100010011100101001000000000100111011111010101110010101111110111101000100110010010100111100000000111100111010100110000011000001010011000010000010000010000000111110011000001000000000010101010111101100110111010110101010111110010010000111111101111100011000011101000100000011000100100100110111100100100010101011110101100000100000101110010111010000011010000110010010010010101001001000000100011000010011110000000011101101111000010100000000000111101110000010111010000110010101000000100011000111100110100010111011101101001001011011111001111110101001011010001110011010110010110010101010101111111010101000100011000110001111001110101001011100011111111100000011000010100010100001010000100111010101111000111111101100000001111101011000011111101001101110111110111010111000000001100101010000110001100101110101110000011100001010100001010101000110100111101111000110100010110101100001000111001101110001110010101010100000000000110100010110111101111011100110110100001000100011011110111100100111101100010101010111100110100100101110111101010110011010001001100110001011000101100101100000111010100011100111111001011001011000111000011011101110111111010111100001101001010001111000101010110001001000011011111111101111011010010110011000110011110000111010100101000111100011000100010100111000001010010000010101100111100110101000001010010001111001111110011011001011000111100101010100111101101000110010110001010100000010011101010100100001100011010100011110100000010110011000001001001110100010010001000011010001110000011101011010111001110100111111001101111010010001000011001111011110001100010100110001101010111111100100000000110110110011110101010101011101000001001111011011111001011011001010000001010100100010110110001000101111100111101111010001100110010111010010010101110101110001010111100011111111011110100001011011011010111010101001101100001100000101010001111101111111000111011001100010111110111010010011011100111000011000101101000010100110010101101000011000110011001101111100010110001111111101011101011110101011010100110101101111110100100111001101110011111010111111000111100110011110011101001001010011010010100011001001000000010011110001111010100100000001011101000010010000111000001000000001111001100110000011100101101110100110101011001100111001111000100110110111001010001000111001000100001110010011111011110000111001101000010001000101100011000001001000101000101101010110111111100001000001111100111011101100100101110001000011101001101010000101011111101001010010001101001000000100111010011000111111010000110110011000111111111011011111100111000011011101100100001100101001011001100011101110110000111110010000011110110110100001111101101000101111101011100000001111101000010011101111011000100101000001000011100000001110010011100000110101011001101000101110010000010100100000101010111000001000110100000110001110110100101000101101110101011100000010000000101110110010100100111001010001010100001101000001001111100001011000100110011110111001101111101100011001100111100000111001000111010101100010000001001001011111101110001101000101101101010011111100000101100001010011001101000011010001001100110111111010010101100011111100001100100100100101011010001000101101010000101010111010000010011100011100001101101100000001110100100111001101111111010001111001101000000100001000011001010001001000001111000010000110100111100010000111000111001110011000111111010100110100000110011101111101111101101100100110101110101110100010101100010010111101110011000111011000100110111011111101100111011110111110010010000011111010100010010000000010101101011111011110001000001001010011110001011000000011001011101010101000011001111100101011101101001001101011010101110001100111011011000100000110011011111001111000010100011110000110010010010101100001011000000110011100111100100111010001110001011010000000010110100101110110110111000010110100010000011111000100010010000010111010010111101101011101010000110010110111111000100011111101001101010111101111100110100011101100100010011010000001101101100011000010001001010000101000101001011010100011110100010101101011000101011100010011110001001000000001111100011111110100011010000001010101110110000111000001000100001101101000100010001111000000110111011001011001101010111010000100010110100100001011011110111110010000111101000001110000111011011100101001100111010000010110001011010100100111111100000100100100010100100001011001000000100010011111011000111110001011101111110100101110100101110010001000111100011100101001001000001101000101111110110001010010100110000011000011010001000010010100111101000010010001111111011111000010001100111100011110011001101101111010101110100100100000000011111111011110010011011111001011101011100001111000110111011111110100001100101110011100101010010101110010100110000011100001010111010100100001000101111110001110101011100101000000011101110111001111110100011010110011101010010001100111100010011110001010011111011010110101110111010100000100111000010011101101111000100001001110100111101110110001110110010100001010110000001011101001000101110010100011001110000000100010011101001100001110010100110101110111001101001010001010010100111110101100011100010110110000001110100010011011111111000001100011000110011001010100001101110101111010000010111010100100000100000001000101101111100101101110100011010111101100111101100101100010100010110111001110111000101001001100010000011111001101111111000010101111001011000111000011011001001010111001010010110011011011010010000001001010110110001011111110110000000011011011010010111100101011101011001001010101110000000111110100101110001110100101111000101110000001101001111100010011111010111110000000011111010001011001001000110010001001111101111000101010000000110001110101011110110000010010111111010101100111110010101101000110001101011100111001111100000000011010110111101110001001111010000110111010010100001000000110010011111100111010101001000010000101111011101100010111000000111100000001000100110101111000000010100100000111001101111001100101111011111101010000011101101111000100101110100100101110011101000110110010000111001011011101100010011010100111010100000010110101110110111001110101100000100000010100001100111011001011001010001110110100100010001001111110110011000011001101000110110001111101111110000101010001101100011100101110010100111010011000100000000110101001000111001001101011000000100001011110100001000101011110100000001111110111000000100000110011110101000101001110000001001010100011000111101100000000101010110111010101");
    //std::string str("23424132214321233132212413414343");
    //std::string str("23424132214321233132212413414343");
    //std::string str("abracadabra");
    //std::string str("DRDOBBS");


    //std::string str("2342413221432123");
    //std::string str("3132212413414314");
    //std::string str("4143212212413213");

    using bwt_type = bwt<int, sa_traits>; // 'int' is in consonance with suffix_array::index_type

    bwt_type::elements_type data(str.begin(), str.end());
    data.push_back(0); // add virtual sentinel

    bwt_type::print(data);
    std::wcout << std::endl << std::endl;

    bwt_type::elements_type encoded_data;
    bwt_type::elements_type decoded_data;

    bwt_type::encode(data, encoded_data);
    bwt_type::print(encoded_data, false);

    std::wcout << std::endl << std::endl;

    bwt_type::decode(encoded_data, decoded_data);
    bwt_type::print(decoded_data);

    std::wcout << ((data == decoded_data) ? L"ok" : L"error") << std::endl << std::endl;
}
